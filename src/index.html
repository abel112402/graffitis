<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Kezdőlap</title>
<script type="module">
import { supabase } from './supabaseClient.js';

async function loadIndex() {
  // lekérdezzük csak a published = true elemeket (RLS is ezt engedi)
    const { data, error } = await supabase
    .from('graffiti')
    .select('id,name,slug')
    .eq('accepted', true)
    .order('name', { ascending: true });

    if (error) return console.error(error);

    const groups = {};
    data.forEach(g => {
    const letter = (g.name || '?').trim().charAt(0).toUpperCase();
    (groups[letter] ||= []).push(g);
    });
    console.log(groups);

    const loginButton = document.createElement('div');
    loginButton.innerHTML = '<h1>Graffiti Galéria</h1><nav><a href="./login.html">Admin Bejelentkezés</a></nav>';
    document.querySelector('header').appendChild(loginButton);
    const uploadButton = document.createElement('div');
    uploadButton.innerHTML = '<nav><a href="./upload.html">Graffiti Feltöltés</a></nav>';
    document.querySelector('header').appendChild(uploadButton);


    const container = document.getElementById('list');
    Object.keys(groups).sort().forEach(letter => {
    const h = document.createElement('h3'); h.innerText = letter;
    container.appendChild(h);
    const ul = document.createElement('ul');
    groups[letter].forEach(item => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = `graffiti.html?slug=${encodeURIComponent(item.slug)}`;
        a.innerText = item.name;
        li.appendChild(a);
        ul.appendChild(li);
    });
    container.appendChild(ul);
    });
}

window.addEventListener('DOMContentLoaded', loadIndex);
</script>
</head>
<body>
<header>

</header>
<div id="list"></div>

</body>
</html>